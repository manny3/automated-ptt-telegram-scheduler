# 開發環境 Dockerfile
# 針對本地開發最佳化，支援熱重載和除錯

FROM node:18-alpine

# 安裝系統依賴
RUN apk add --no-cache \
    libc6-compat \
    curl \
    bash \
    git

# 設定工作目錄
WORKDIR /app

# 建立非 root 使用者
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# 複製 package 檔案
COPY package.json package-lock.json* ./

# 安裝依賴 (包含開發依賴)
RUN npm ci

# 複製原始碼
COPY . .

# 設定權限
RUN chown -R nextjs:nodejs /app
USER nextjs

# 暴露端口
EXPOSE 3000 9229

# 設定環境變數
ENV NODE_ENV=development
ENV NEXT_TELEMETRY_DISABLED=1

# 開發模式啟動命令
CMD ["npm", "run", "dev"]