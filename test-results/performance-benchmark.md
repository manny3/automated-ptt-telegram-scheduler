# 測試效能基準報告

## 執行環境
- **日期**: 2025-01-26
- **機器**: macOS (darwin)
- **Node.js**: v20.12.2
- **Jest**: 29.7.0

## 效能指標

### 測試執行時間
- **總執行時間**: 229.059 秒
- **測試套件數量**: 23
- **測試案例數量**: 180
- **平均每個測試套件**: 9.96 秒
- **平均每個測試案例**: 1.27 秒

### 最慢的測試套件
1. **Firestore 測試**: 32.26 秒
2. **Secret Manager 測試**: 約 118 秒 (因為重試機制)
3. **整合測試**: 約 0.47 秒 (快速失敗)

### 記憶體使用
- **Jest Worker 異常**: 多個測試套件遇到 worker 進程異常
- **建議**: 調整 `maxWorkers` 配置

### 測試覆蓋率效能
- **覆蓋率收集時間**: 包含在總執行時間內
- **覆蓋率報告生成**: 正常
- **HTML 報告**: 成功生成

## 效能問題分析

### 1. 長時間執行的測試
- **Secret Manager 測試**: 因為實際 API 呼叫和重試機制導致執行時間過長
- **Firestore 測試**: 同樣因為實際 API 呼叫導致延遲

### 2. Jest Worker 問題
- 多個測試套件遇到 worker 進程異常
- 可能是記憶體不足或進程衝突

### 3. 模組載入效能
- ESM 模組解析問題導致額外的載入時間
- 某些模組需要額外的轉換時間

## 建議改善措施

### 短期改善
1. **改善 Mock 設定**
   - 避免實際 API 呼叫
   - 減少網路延遲

2. **調整 Jest 配置**
   ```javascript
   {
     maxWorkers: "50%",
     testTimeout: 10000,
     setupFilesAfterEnv: ['<rootDir>/jest.setup.js']
   }
   ```

### 長期改善
1. **測試分層**
   - 單元測試: < 1 秒
   - 整合測試: < 5 秒
   - E2E 測試: < 30 秒

2. **並行執行優化**
   - 獨立的測試套件可以並行執行
   - 避免共享狀態

3. **快取策略**
   - 利用 Jest 的快取機制
   - 避免重複的模組載入

## 基準目標

### 理想效能目標
- **總執行時間**: < 60 秒
- **單元測試**: < 0.5 秒/測試
- **整合測試**: < 2 秒/測試
- **覆蓋率收集**: < 10 秒額外時間

### 可接受效能目標
- **總執行時間**: < 120 秒
- **單元測試**: < 1 秒/測試
- **整合測試**: < 5 秒/測試
- **覆蓋率收集**: < 20 秒額外時間

## 監控建議

1. **設定效能警報**
   - 當測試執行時間超過 180 秒時發出警告
   - 監控個別測試的執行時間

2. **定期效能檢查**
   - 每週檢查測試執行時間趨勢
   - 識別效能退化的測試

3. **CI/CD 整合**
   - 在 CI 中記錄測試執行時間
   - 設定效能基準檢查